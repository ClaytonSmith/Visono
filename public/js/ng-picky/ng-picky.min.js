/* ng-picky v0.0.1 | (c) 2015 Dan Prince | MIT */
angular.module("ngPicky",[]).directive("picker",["Color",function(a){return{restrict:"EA",scope:{color:"=",pick:"&"},controller:["$scope",function(b){b.hue=0,b.color=a.create(255,255,255),b.selectColor=function(a){b.color=a,b.pick({$color:a})}}],template:"<div class='picker'>       <div class='picker-wrapper'>         <color-space hue='hue' pick='selectColor($color)'></color-space>         <hue-space hue='hue'></hue-space>       </div>       <converters color='color'></converters>     </div>"}}]).directive("colorSpace",["Widgets","Color","ConvertColor","PickerUtils","ColorCache",function(a,b,c,d,e){return{restrict:"E",replace:!0,scope:{hue:"=",pick:"&"},template:"<section class='picker-colorspace'></section>",link:function(c,f){var g=a.canvas(),h=g.canvas,i=g.context,j=a.cursor("&#9675;");c.$watch("hue",function(){c.repaint(),c.select()}),c.select=function(){var a,e,f;a=d.stripPx(j.element.style.left),e=d.stripPx(j.element.style.top),f=i.getImageData(a,e,1,1).data,c.pick({$color:b.create(f[0],f[1],f[2])})},c.moveCursor=function(a){var b=this.getBoundingClientRect(),d=a.pageX-b.left,e=a.pageY-b.top;j.element.style.left=d+"px",j.element.style.top=e+"px",c.select(),c.$apply()},c.mouseMove=function(a){c.mousedown&&c.moveCursor.call(this,a)},c.mouseToggle=function(a){c.mousedown=a},c.resize=function(){h.width=f.prop("offsetWidth"),h.height=f.prop("offsetHeight")},c.repaint=function(){var a=e.get(c.hue);a?i.putImageData(a,0,0):(c.paint(),a=i.getImageData(0,0,h.width,h.height),e.set(c.hue,a))},c.paint=function(){var a,b,d,e,f;for(a=c.hue,b=0,d=0,e=0;e<h.height;e++)d=100-e/h.height*100,f=i.createLinearGradient(0,0,h.width,0),f.addColorStop(0,"hsl("+a+", 0%, "+d+"%)"),f.addColorStop(1,"hsl("+a+", 100%, "+d+"%)"),i.fillStyle=f,i.fillRect(0,e,h.width,1)},c.resize(),c.mousedown=!1,c.paint(),f.append(h),f.append(j.element),h.addEventListener("mouseup",c.mouseToggle.bind(null,!1)),h.addEventListener("mousedown",c.mouseToggle.bind(null,!0)),h.addEventListener("mousemove",c.mouseMove),h.addEventListener("click",c.moveCursor)}}}]).directive("hueSpace",["Widgets","PickerUtils",function(a,b){return{restrict:"E",replace:!0,scope:{hue:"=",pick:"&"},template:"<aside class='picker-huespace'></aside>",link:function(c,d){var e=a.canvas(),f=e.canvas,g=e.context,h=a.cursor("&#9654;");c.select=function(){var a=b.stripPx(h.element.style.top);c.hue=Math.round(a/f.height*360),c.$apply()},c.moveCursor=function(a){var b=this.getBoundingClientRect(),d=a.pageY-b.top;h.element.style.top=d+"px",c.select(),c.$apply()},c.mouseMove=function(a){c.mousedown&&c.moveCursor.call(this,a)},c.mouseToggle=function(a){c.mousedown=a},c.resize=function(){f.width=d.prop("offsetWidth"),f.height=d.prop("offsetHeight")},c.paint=function(){var a=0;for(y=0;y<f.height;y++)a=y/f.height*360,g.fillStyle="hsl("+a+", 100%, 50%)",g.fillRect(0,y,f.width,1)},c.resize(),c.mousedown=!1,c.paint(),d.append(f),d.append(h.element),f.addEventListener("mouseup",c.mouseToggle.bind(null,!1)),f.addEventListener("mousedown",c.mouseToggle.bind(null,!0)),f.addEventListener("mousemove",c.mouseMove),f.addEventListener("click",c.moveCursor)}}}]).directive("converters",function(){return{restrict:"E",scope:{color:"="},template:"<section class='picker-input'>       <div class='picker-row'>         <span class='picker-prefix'>#</span>         <input type='text' placeholder='FFFFFF'                ng-value='color | toUnprefixedHex'/>       </div>     </section>"}}).filter("toHex",["Color",function(a){return function(b){return b||(b=a["default"]()),b.toHex()}}]).filter("toUnprefixedHex",function(){return function(a){return a.toUnprefixedHex()}}).filter("toRGB",function(){return function(a){return["rgb(",a.toRGB().join(","),")"].join("")}}).filter("toHSL",function(){return function(a){return["hsl(",a.toHSL().join(","),")"].join("")}}).service("Color",["Hex",function(a){function b(a,b,c){this.r=a,this.g=b,this.b=c}b.prototype.toRGB=function(){return[this.r,this.g,this.b]},b.prototype.toHex=function(){return"#"+this.toUnprefixedHex()},b.prototype.toUnprefixedHex=function(){return this.toRGB().map(this.decToHex).join("")},b.prototype.toHSL=function(){var a,b,c,d,e,f,g,h,i,j,k;return a=this.r/255,b=this.g/255,c=this.b/255,d=Math.min(a,b,c),e=Math.max(a,b,c),i=e-d,h=(e+d)/2,0===i?(f=0,g=0):.5>h?g=i/(e+d):(g=i/(2-e-d),j=((e-a)/6+i/2)/i,k=((e-b)/6+i/2)/i,db=((e-c)/6+i/2)/i,f=a===e?db-k:b===e?1/3+j-db:2/3+k-j,0>f&&(f+=1),f>1&&(f-=1)),[360*f,g,h]},b.prototype.decToHex=function(b){return a.pad(b.toString(16))},this.create=function(a,c,d){return new b(a,c,d)},this["default"]=function(){return new b(255,255,255)}}]).service("ConvertColor",["Color","Hex",function(a,b){this.fromRGB=function(b,c,d){return a.create(b,c,d)},this.fromHex=function(c){var d=b.normalize(c),e=[],f=null,g=0;for(g=0;6>g;g+=2)f=d.slice(g,g+2),e.push(parseInt(f,16));return a.create.apply(null,e)},this.fromHSL=function(b,c,d){var e,f,g,h;return e=(1-Math.abs(2*d-1))*c,f=b/60,g=e*(1-Math.abs(f%2-1)),f>=0&&1>f&&(h=[e,g,0]),f>=1&&2>f&&(h=[g,e,0]),f>=2&&3>f&&(h=[0,e,g]),f>=3&&4>f&&(h=[0,g,e]),f>=4&&5>f&&(h=[g,0,e]),f>=5&&6>f&&(h=[e,0,g]),m=d-e/2,a.create.apply(null,h.map(function(a){return a+m}))}}]).service("Hex",function(){this.validator=new RegExp(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/),this.validate=function(a){var b=a.match(this.validator);return b?b.pop():null},this.pad=function(a){return("00"+a).slice(-2)},this.normalize=function(a){function b(a,b){a.concat(b)}function c(a){return[a,a]}var d=this.validate(a);return 3===d.length?d.split("").map(c).reduce(b,[]).join(""):d}}).service("Widgets",function(){this.cursor=function(a){var b=document.createElement("div");return b.innerHTML=a,b.setAttribute("class","picker-cursor"),b.style.position="absolute",b.style.top=0,b.style.left=0,{element:b,x:0,y:0}},this.canvas=function(){var a=document.createElement("canvas"),b=a.getContext("2d");return{canvas:a,context:b}}}).service("ColorCache",function(){var a={};this.get=function(b){return a[b]},this.set=function(b,c){a[b]||(a[b]=c)}}).service("PickerUtils",function(){this.stripPx=function(a){return a.slice(0,a.length-2)}});