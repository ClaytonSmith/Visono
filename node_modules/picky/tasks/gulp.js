
/*!
 * Picky
 * @license MIT
 */

if ('gulp' !== process.title) return;

/*
 * Module dependencies
 */

var through = require('through2');
var Picky = require('../index');

/*
 * Variables
 */

var Suite = Picky.Suite;

/*
 * Exports
 */

module.exports = function (gulp, options) {
  var suite = new Suite(options);

  return through.obj(read, end);

  function read (file, enc, done) {
    if (file.isStream()) {
      this.emit('error', new gutil.PluginError('Picky',  'Streaming not supported'));
      return done();
    }
    suite.addFile(file.path);
    this.push(file);
    done();
  }

  function end (done) {
    var me = this;
    return suite.run(function (err) {
      if (err) me.emit('error', err);
      else me.emit('end');
      done();
    });
  }

}
